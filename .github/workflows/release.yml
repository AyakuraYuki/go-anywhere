name: Release

on:
  push:
    tags:
      - "v*.*.*"
  workflow_dispatch:
    inputs:
      version:
        description: "Release version"
        required: true

jobs:
  build:
    name: Build

    strategy:
      matrix:
        os: [ macos-latest, ubuntu-latest, windows-latest ]
        goos: [ darwin, linux, windows ]
        goarch: [ arm64, amd64 ]
        include:
          - os: macos-latest
            goos: darwin
          - os: ubuntu-latest
            goos: linux
          - os: windows-latest
            goos: windows

    runs-on: ${{ matrix.os }}

    env:
      GO111MODULE: "on"
      CGO_ENABLED: "0"
      GOOS: ${{ matrix.goos }}
      GOARCH: ${{ matrix.goarch }}

    steps:
      - run: echo $GO111MODULE
      - run: echo $CGO_ENABLED
      - run: echo $GOOS
      - run: echo $GOARCH
